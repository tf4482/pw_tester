{% extends "base.html" %}

{% block title %}üîê PW Tester - Password Security Analysis{% endblock %}

{% block content %}
<div class="px-4 sm:px-0">
    <!-- Hero Section -->
    <div class="text-center mb-12">
        <h1 class="text-4xl font-bold text-gray-900 mb-4">
            üîê Password Security Analyzer
        </h1>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
            Analyze your password strength and get estimated brute force times across different attack scenarios.
            Your password is never stored or logged.
        </p>
    </div>

    <!-- Password Analysis Form -->
    <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-semibold text-gray-900 mb-6 flex items-center">
                <i class="fas fa-key text-blue-600 mr-3"></i>
                Enter Password to Analyze
            </h2>
            
            <form id="password-form" class="space-y-4">
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                        Password
                    </label>
                    <div class="relative">
                        <input type="password" 
                               id="password" 
                               name="password" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                               placeholder="Enter your password here..."
                               required>
                        <button type="button" 
                                id="toggle-password" 
                                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600">
                            <i class="fas fa-eye" id="eye-icon"></i>
                        </button>
                    </div>
                </div>
                
                <button type="submit" 
                        class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors font-medium">
                    <i class="fas fa-search mr-2"></i>
                    Analyze Password
                </button>
            </form>
        </div>

        <!-- Loading Spinner -->
        <div id="loading" class="hidden text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <p class="mt-2 text-gray-600">Analyzing password...</p>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden">
            <!-- Password Properties -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-chart-bar text-blue-600 mr-3"></i>
                    Password Properties
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Length</div>
                        <div class="text-lg font-semibold" id="length"></div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Character Space</div>
                        <div class="text-lg font-semibold" id="character-space"></div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Entropy</div>
                        <div class="text-lg font-semibold" id="entropy"></div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Complexity</div>
                        <div class="text-lg font-semibold" id="complexity"></div>
                    </div>
                </div>
                <div class="mt-4 bg-gray-50 p-4 rounded-lg">
                    <div class="text-sm text-gray-600">Total Combinations</div>
                    <div class="text-lg font-semibold" id="combinations"></div>
                </div>
            </div>

            <!-- Brute Force Times -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-bolt text-yellow-600 mr-3"></i>
                    Brute Force Time Estimates
                </h3>
                <div class="space-y-3" id="brute-force-times">
                    <!-- Times will be populated by JavaScript -->
                </div>
            </div>

            <!-- Recommendations -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-lightbulb text-yellow-500 mr-3"></i>
                    Recommendations
                </h3>
                <ul class="space-y-2" id="recommendations">
                    <!-- Recommendations will be populated by JavaScript -->
                </ul>
            </div>
        </div>

        <!-- Error Message -->
        <div id="error" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
            <div class="flex">
                <i class="fas fa-exclamation-triangle text-red-400 mr-3 mt-1"></i>
                <div>
                    <h3 class="text-sm font-medium text-red-800">Error</h3>
                    <p class="text-sm text-red-700 mt-1" id="error-message"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Security Notice -->
    <div class="max-w-4xl mx-auto mt-12">
        <div class="bg-green-50 border border-green-200 rounded-lg p-6">
            <div class="flex">
                <i class="fas fa-shield-alt text-green-400 mr-3 mt-1"></i>
                <div>
                    <h3 class="text-sm font-medium text-green-800">Security & Privacy</h3>
                    <div class="text-sm text-green-700 mt-1">
                        <ul class="list-disc list-inside space-y-1">
                            <li>Your password is analyzed locally and never stored or transmitted</li>
                            <li>All analysis happens in real-time without logging</li>
                            <li>Time estimates are theoretical and may vary in real-world scenarios</li>
                            <li>Always use strong, unique passwords with multi-factor authentication</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('password-form');
    const passwordInput = document.getElementById('password');
    const toggleButton = document.getElementById('toggle-password');
    const eyeIcon = document.getElementById('eye-icon');
    const loading = document.getElementById('loading');
    const results = document.getElementById('results');
    const error = document.getElementById('error');

    // Toggle password visibility
    toggleButton.addEventListener('click', function() {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        eyeIcon.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
    });

    // Form submission
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const password = passwordInput.value;
        if (!password) return;

        // Show loading, hide results and errors
        loading.classList.remove('hidden');
        results.classList.add('hidden');
        error.classList.add('hidden');

        try {
            const response = await fetch('/api/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ password: password })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'Analysis failed');
            }

            displayResults(data);
        } catch (err) {
            showError(err.message);
        } finally {
            loading.classList.add('hidden');
        }
    });

    function displayResults(data) {
        // Update password properties
        document.getElementById('length').textContent = `${data.password_length} characters`;
        document.getElementById('character-space').textContent = `${data.character_space} possible characters`;
        document.getElementById('entropy').textContent = `${data.entropy_bits} bits`;
        document.getElementById('combinations').textContent = data.total_combinations.toLocaleString();
        
        // Update complexity with color
        const complexityElement = document.getElementById('complexity');
        complexityElement.textContent = data.complexity_score;
        complexityElement.className = `text-lg font-semibold ${getComplexityColor(data.complexity_score)}`;

        // Update brute force times
        const timesContainer = document.getElementById('brute-force-times');
        timesContainer.innerHTML = '';
        
        const scenarios = {
            'basic_cpu': { name: 'üíª Basic CPU (1M/s)', icon: 'fas fa-desktop' },
            'modern_cpu': { name: 'üñ•Ô∏è Modern CPU (100M/s)', icon: 'fas fa-microchip' },
            'gpu_single': { name: 'üéÆ Single GPU (10B/s)', icon: 'fas fa-gamepad' },
            'gpu_cluster': { name: 'üî• GPU Cluster (1T/s)', icon: 'fas fa-fire' },
            'quantum_future': { name: 'üöÄ Quantum Computer (1P/s)', icon: 'fas fa-rocket' }
        };

        for (const [key, time] of Object.entries(data.brute_force_times)) {
            if (scenarios[key]) {
                const timeDiv = document.createElement('div');
                timeDiv.className = 'flex justify-between items-center p-3 bg-gray-50 rounded-lg';
                timeDiv.innerHTML = `
                    <span class="font-medium">${scenarios[key].name}</span>
                    <span class="font-semibold ${getTimeColor(time)}">${time}</span>
                `;
                timesContainer.appendChild(timeDiv);
            }
        }

        // Update recommendations
        const recommendationsContainer = document.getElementById('recommendations');
        recommendationsContainer.innerHTML = '';
        
        data.recommendations.forEach(rec => {
            const li = document.createElement('li');
            li.className = 'flex items-start';
            const isGood = rec.toLowerCase().includes('good complexity');
            const icon = isGood ? 'fas fa-check-circle text-green-500' : 'fas fa-exclamation-triangle text-yellow-500';
            li.innerHTML = `
                <i class="${icon} mr-2 mt-1"></i>
                <span>${rec}</span>
            `;
            recommendationsContainer.appendChild(li);
        });

        results.classList.remove('hidden');
    }

    function getComplexityColor(complexity) {
        const colors = {
            'Very Weak': 'text-red-600',
            'Weak': 'text-red-500',
            'Medium': 'text-yellow-600',
            'Strong': 'text-green-600',
            'Very Strong': 'text-green-700'
        };
        return colors[complexity] || 'text-gray-600';
    }

    function getTimeColor(time) {
        if (time.toLowerCase().includes('uncrackable')) return 'text-green-600';
        if (time.includes('years')) return 'text-green-500';
        if (time.includes('days')) return 'text-yellow-600';
        if (time.includes('hours')) return 'text-orange-500';
        return 'text-red-600';
    }

    function showError(message) {
        document.getElementById('error-message').textContent = message;
        error.classList.remove('hidden');
    }
});
</script>
{% endblock %}
